```
[centos@ip-10-1-1-86 aws-fpga]$ source sdk_setup.sh
Done setting environment variables.
Entering /home/centos/src/project_data/aws-fpga/sdk/userspace/utils
rm -f *.o *.a ../lib/libutils.a
cc -DCONFIG_LOGLEVEL=0 -DFPGA_PCI_BARS_MAX=64 -g -std=gnu99 -fPIC -Wall -Werror -W -Wno-parentheses -Wstrict-prototypes -Wmissing-prototypes -I. -I../include -I/usr/include   -c -o io.o io.c
cc -DCONFIG_LOGLEVEL=0 -DFPGA_PCI_BARS_MAX=64 -g -std=gnu99 -fPIC -Wall -Werror -W -Wno-parentheses -Wstrict-prototypes -Wmissing-prototypes -I. -I../include -I/usr/include   -c -o log.o log.c
cc -DCONFIG_LOGLEVEL=0 -DFPGA_PCI_BARS_MAX=64 -g -std=gnu99 -fPIC -Wall -Werror -W -Wno-parentheses -Wstrict-prototypes -Wmissing-prototypes -I. -I../include -I/usr/include   -c -o logger-kmsg.o logger-kmsg.c
mkdir -p ../lib
ar rcs ../lib/libutils.a io.o log.o logger-kmsg.o
Entering /home/centos/src/project_data/aws-fpga/sdk/userspace/fpga_libs/fpga_pci
rm -f *.o ../../lib/libfpga_pci.a
cc -DCONFIG_LOGLEVEL=0 -DFPGA_PCI_BARS_MAX=64 -g -std=gnu99 -fPIC -Wall -Werror -W -Wno-parentheses -Wstrict-prototypes -Wmissing-prototypes -I. -I../../include -I/usr/include   -c -o fpga_pci.o fpga_pci.c
cc -DCONFIG_LOGLEVEL=0 -DFPGA_PCI_BARS_MAX=64 -g -std=gnu99 -fPIC -Wall -Werror -W -Wno-parentheses -Wstrict-prototypes -Wmissing-prototypes -I. -I../../include -I/usr/include   -c -o fpga_pci_sysfs.o fpga_pci_sysfs.c
mkdir -p ../../lib
ar rcs ../../lib/libfpga_pci.a fpga_pci.o fpga_pci_sysfs.o
Entering /home/centos/src/project_data/aws-fpga/sdk/userspace/fpga_libs/fpga_mgmt
rm -f *.o ../../lib/libfpga_mgmt.a ../../lib/so/libfpga_mgmt.so
cc -DCONFIG_LOGLEVEL=0 -DFPGA_PCI_BARS_MAX=64 -g -std=gnu99 -fPIC -Wall -Werror -W -Wno-parentheses -Wstrict-prototypes -Wmissing-prototypes -I. -I../../include -I/usr/include   -c -o fpga_mgmt.o fpga_mgmt.c
cc -DCONFIG_LOGLEVEL=0 -DFPGA_PCI_BARS_MAX=64 -g -std=gnu99 -fPIC -Wall -Werror -W -Wno-parentheses -Wstrict-prototypes -Wmissing-prototypes -I. -I../../include -I/usr/include   -c -o fpga_mgmt_cmd.o fpga_mgmt_cmd.c
cc -DCONFIG_LOGLEVEL=0 -DFPGA_PCI_BARS_MAX=64 -g -std=gnu99 -fPIC -Wall -Werror -W -Wno-parentheses -Wstrict-prototypes -Wmissing-prototypes -I. -I../../include -I/usr/include   -c -o fpga_hal_mbox.o fpga_hal_mbox.c
mkdir -p ../../lib
for library in ../../lib/libfpga_pci.a ../../lib/libutils.a; do ar -x $library; done
ar rcs ../../lib/libfpga_mgmt.a *.o
mkdir -p ../../lib/so
cc -o ../../lib/so/libfpga_mgmt.so -shared fpga_mgmt.o fpga_mgmt_cmd.o fpga_hal_mbox.o -Wl,-soname,libfpga_mgmt.so -Wl,--whole-archive ../../lib/libfpga_pci.a ../../lib/libutils.a -Wl,--no-whole-archive -lrt -lpthread
Entering /home/centos/src/project_data/aws-fpga/sdk/userspace/fpga_mgmt_tools/src
rm -f *.o *.a fpga-local-cmd static-fpga-local-cmd
cc -DCONFIG_LOGLEVEL=0 -DFPGA_PCI_BARS_MAX=64 -g  -Wall -Werror -W -Wno-parentheses -Wstrict-prototypes -Wmissing-prototypes -I../../include/hal -I../../include -I../. -I.   -c -o fpga_local_cmd.o fpga_local_cmd.c
cc -DCONFIG_LOGLEVEL=0 -DFPGA_PCI_BARS_MAX=64 -g  -Wall -Werror -W -Wno-parentheses -Wstrict-prototypes -Wmissing-prototypes -I../../include/hal -I../../include -I../. -I.   -c -o fpga_local_cmd_parse.o fpga_local_cmd_parse.c
cc -DCONFIG_LOGLEVEL=0 -DFPGA_PCI_BARS_MAX=64 -g  -Wall -Werror -W -Wno-parentheses -Wstrict-prototypes -Wmissing-prototypes -I../../include/hal -I../../include -I../. -I.   -c -o virtual_jtag_pcie.o virtual_jtag_pcie.c
cc -DCONFIG_LOGLEVEL=0 -DFPGA_PCI_BARS_MAX=64 -g  -Wall -Werror -W -Wno-parentheses -Wstrict-prototypes -Wmissing-prototypes -I../../include/hal -I../../include -I../. -I.   -c -o virtual_jtag_server.o virtual_jtag_server.c
cc -o fpga-local-cmd fpga_local_cmd.o fpga_local_cmd_parse.o virtual_jtag_pcie.o virtual_jtag_server.o -L../../lib/so -lfpga_mgmt
cc -o static-fpga-local-cmd fpga_local_cmd.o fpga_local_cmd_parse.o virtual_jtag_pcie.o virtual_jtag_server.o -L../../lib -lfpga_mgmt -lrt -lpthread
AWS FPGA: Copying Amazon FPGA Image (AFI) Management Tools to /usr/bin
AWS FPGA: Done with Amazon FPGA Image (AFI) Management Tools install.
Done with SDK install.
Done with AWS SDK setup.
```
```
  [centos@ip-10-1-1-86 aws-fpga]$ sourcehdk_setup.sh
  AWS FPGA-INFO: Using Vivado v2017.1 (64-bit)
  AWS FPGA-INFO: Setting up environment variables
  AWS FPGA-INFO: Using HDK shell version shell_v04151701
  AWS FPGA-INFO: HDK shell is up-to-date
  AWS FPGA-INFO: DDR4 model files in /home/centos/src/project_data/aws-fpga/hdk/common/verif/models/ddr4_model/ were built with Vivado v2017.1 (64-bit)
  AWS FPGA-INFO: ATTENTION: Don't forget to set the CL_DIR variable for the directory of your Custom Logic.
  AWS FPGA-INFO: AWS HDK setup PASSED.
```




[centos@ip-10-1-1-86 scripts]$ aws ec2 create-fpga-image --name test0426 --description "This is first test for AFI creation" --input-storage-location Bucket=f1-backup,Key=tarfiles/17_04_25-032348.Developer_CL.tar --logs-storage-location Bucket=f1-backup,Key=logsfiles/*  --client-token 20170426  --dry-run

An error occurred (DryRunOperation) when calling the CreateFpgaImage operation: Request would have succeeded, but DryRun flag is set.
[centos@ip-10-1-1-86 scripts]$ aws ec2 create-fpga-image --name test0426 --description "This is first test for AFI creation" --input-storage-location Bucket=f1-backup,Key=tarfiles/17_04_25-032348.Developer_CL.tar --logs-storage-location Bucket=f1-backup,Key=logsfiles/*  --client-token 20170426
{
    "FpgaImageId": "afi-07baefdc2da3e6234",
    "FpgaImageGlobalId": "agfi-00f17e5e25a3c9709"
}




[ec2-user@ip-10-1-1-56 aws-fpga]$ cd hdk/cl/examples/cl_hello_world/software/runtime/
[ec2-user@ip-10-1-1-56 runtime]$ ls
Makefile  test_hello_world.c
[ec2-user@ip-10-1-1-56 runtime]$ make all
gcc -DCONFIG_LOGLEVEL=4 -g -Wall -I/home/ec2-user/aws-fpga/sdk/userspace/include   -c -o test_hello_world.o test_hello_world.c
gcc -DCONFIG_LOGLEVEL=4 -g -Wall -I/home/ec2-user/aws-fpga/sdk/userspace/include -o test_hello_world test_hello_world.o  -lfpga_mgmt -lrt -lpthread
[ec2-user@ip-10-1-1-56 runtime]$ ls -l
total 44
-rw-rw-r-- 1 ec2-user ec2-user  1122 Apr 27 06:37 Makefile
-rwxrwxr-x 1 ec2-user ec2-user 16260 Apr 27 07:22 test_hello_world
-rw-rw-r-- 1 ec2-user ec2-user  7379 Apr 27 06:37 test_hello_world.c
-rw-rw-r-- 1 ec2-user ec2-user 15304 Apr 27 07:22 test_hello_world.o
[ec2-user@ip-10-1-1-56 runtime]$ sudo ./test_hello_world
AFI PCI  Vendor ID: 0x1d0f, Device ID 0xf000
===== Starting with peek_poke_example =====
register: 0xdeadbeef
Resulting value matched expected value 0xdeadbeef. It worked!
Developers are encourged to modify the Virtual DIP Switch by calling the linux shell command to demonstrate how AWS FPGA Virtual DIP switches can be used to change a CustomLogic functionality:
$ fpga-set-virtual-dip-switch -S (slot-id) -D (16 digit setting)

In this example, setting a virtual DIP switch to zero clears the corresponding LED, even if the peek-poke example would set it to 1.
For instance:
# fpga-set-virtual-dip-switch -S 0 -D 1111111111111111
# fpga-get-virtual-led  -S 0
FPGA slot id 0 have the following Virtual LED:
1010-1101-1101-1110
# fpga-set-virtual-dip-switch -S 0 -D 0000000000000000
# fpga-get-virtual-led  -S 0
FPGA slot id 0 have the following Virtual LED:
0000-0000-0000-0000
[ec2-user@ip-10-1-1-56 runtime]$ ls
Makefile  test_hello_world  test_hello_world.c  test_hello_world.o



// Amazon FPGA Hardware Development Kit
//
// Copyright 2016 Amazon.com, Inc. or its affiliates. All Rights Reserved.
//
// Licensed under the Amazon Software License (the "License"). You may not use
// this file except in compliance with the License. A copy of the License is
// located at
//
//    http://aws.amazon.com/asl/
//
// or in the "license" file accompanying this file. This file is distributed on
// an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or
// implied. See the License for the specific language governing permissions and
// limitations under the License.

`ifndef CL_COMMON_DEFAULTS
`define CL_COMMON_DEFAULTS

// Value to return for PCIS access to unimplemented register address
`define UNIMPLEMENTED_REG_VALUE 32'hdeaddead

// CL Register Addresses
`define HELLO_WORLD_REG_ADDR    32'h0000_0500
`define VLED_REG_ADDR           32'h0000_0504

`endif


check_s3_bucket_policy.py --dcp-bucket 0530-F1test --dcp-key tar/*.tar --logs-bucket 0530-F1test --logs-key log

aws ec2 create-fpga-image --name test0530 --description "This is first test for AFI creation" --input-storage-location Bucket=0530-F1test,Key=17_05_30-022100.Developer_CL.tar --logs-storage-location Bucket=0530-F1test,Key=log

[centos@ip-10-1-1-86 to_aws]$ aws ec2 create-fpga-image --name test0530 --description "This is first test for AFI creation" --input-storage-location Bucket=0530-F1test,Key=tar/17_05_30-022100.Developer_CL.tar --logs-storage-location Bucke
t=0530-F1test,Key=log/  --client-token 20170530                                                                                                                                                                                               
{
    "FpgaImageId": "afi-0294dcb4404b79962",
    "FpgaImageGlobalId": "agfi-018d65d75893e3061"
}


[centos@ip-10-1-1-86 scripts]$ aws ec2 create-fpga-image --name 0607-aes --description "aes test" --input-storage-location Bucket=f1-backup,Key=tarfiles/17_06_07-044846.Developer_CL.tar --logs-storage-location Bucket=f1-backup,Key=logfiles/ --client-token 20170607
{
    "FpgaImageId": "afi-04b6f2acd91ceaf6d",
    "FpgaImageGlobalId": "agfi-05d1f8e015965f4ec"
}
[centos@ip-10-1-1-86 scripts]$



aws s3 設定用　スクリプト

aws s3 mb s3://f1-backup --region us-east-1
//aws s3 mb s3://f1-backup/tarfiles
aws s3 cp $CL_DIR/build/checkpoints/to_aws/*.Developer_CL.tar s3://f1-backup/tarfiles/

//aws s3 mb s3://f1-backup/logfiles
//touch LOGS_FILES_GO_HERE.txt
//aws s3 cp LOGS_FILES_GO_HERE.txt s3://f1-backup/logfiles/


check_s3_bucket_policy.py \
	--dcp-bucket f1-backup \
	--dcp-key tarfiles/*.Developer_CL.tar \
	--logs-bucket f1-backup \
	--logs-key logfiles



bucket policy が変わった模様
以下最新版
```
{
       "Version": "2012-10-17",
       "Statement": [
           {
               "Sid": "Bucket level permissions",
               "Effect": "Allow",
               "Principal": {
                   "AWS": "arn:aws:iam::365015490807:root"
               },
               "Action": [
                   "s3:ListBucket"
               ],
               "Resource": "arn:aws:s3:::f1-backup"
           },
           {
               "Sid": "Object read permissions",
               "Effect": "Allow",
               "Principal": {
                   "AWS": "arn:aws:iam::365015490807:root"
               },
               "Action": [
                   "s3:GetObject"
               ],
               "Resource": "arn:aws:s3:::f1-backup/tarfiles/*.Developer_CL.tar"
           },
           {
               "Sid": "Folder write permissions",
               "Effect": "Allow",
               "Principal": {
                   "AWS": "arn:aws:iam::365015490807:root"
               },
               "Action": [
                   "s3:PutObject"
               ],
               "Resource": "arn:aws:s3:::f1-backup/logfiles/*"
           }
       ]
   }
```
